
# Simulated Data Summary

This release contains FITS files for all the RAW input files listed in the "Input Data" entries for the 
recipe descriptions in Chapter 6 of the DRLD.  Each file has the correct dimensions, plus compliant keywords 
as required for developing the EDPS skeleton, specifically the matched keywords and derived aliases, as well 
as the standard FITS keywords provided by ScopeSim. 

## Included Keywords

 - DET.DIT
 - DET.NDIT
 - DPR.CATG
 - DPR.TECH
 - DPR.TYPE
 - INS.MODE
 - INS.OPTI*.NAME (depends on instrument)
 - SEQ.WCU.LASERn

 - DRS.FILTER
 - DRS.SLIT
 - DRS.IFU
 - DRS.MASK
 - DRS.PUPIL

## FITS file contents

All of the FITS files were generated by ScopeSim using the provided
script. In most cases, they contain data which is a first
approximation of real data; further work is needed in many cases to
set DIT/NDIT/Filters for reasonable flux levels, and to refine the
choice of science targets and standard stars for more accurate (and
science-case appropriate) choices. We have generated data and
calibrations for one set of filters for each mode as a base set; this
can easily be extended to multiple sets as needed. For images where
the data will be averaged, two files have been generated with
different time of observation and the same settings. 

The coronagraph, pupil imaging and chopper home images currently
contain placeholder data as these are not modes sximulated by
ScopeSim; by the next release these will be updated to include input
simulated images.

This release does not include external calibration files (such as source catalogues).
FITS keywords needed by the recipes themselves (but not by the EDPS skeleton) may not
be complete. 

A summary spreadsheet of the files can be found [here].(https://docs.google.com/spreadsheets/d/1aYQh6Nd17dvrPYVx3D96VwUFsnswIY7DlfNHgKLCVys/edit#gid=0)

The set of simulations is as follows

## Science + Calibrations

- LM/N Science Source: a star field 
- LSS/IFU Science Source: extended galaxy

  - sky fields for each science exposure
  - standard star (centred point source) for each filter/instrument combination
  - sky fields for each standard star

- Coronagraphic RAW Files for

   - RAVC,LM, APP,LM, RAVC,IFU
       - sky fields for each mode
       - off axis PSF

- Flat field / RSRF as appropriate for each  instrument / filter combination.
- RSRF images are generated for two lamp temperatures. 

- Dark Frames for each exposure time / instrument combination
   
## Technical and Calibrations

- Set of images for detector linearity and gain calculationes
- Distortion images with the pinhole mask
- RSRF images with the pinhole mask for order tracing
- set of images for slitloss determination
- set of laser spectrum images for wavelength calibration
- chopperhome images
- pupil images
- dark frames to match the exposure times for the above

The list of  RAW files was compiled from the DRLD recipe listings
in Chapter 6, specifically the "Input Data" entry. FITS keywords and file types were
cross-checked against

    - INS.mode values of Table 2 of the DRLD.
    - List of needed calibrations / mode from Table 4
    - Alias keywords (needed for the EDPS skeleton)  given in Table 5
    - Matched keywords (needed for the EDPS skeleton)  given in Table 6.
    - The DPR.CATG, TECH, TYPE etc. given in Table 20.

## Generating the Files

The files are generated via the scripts found in METIS_Simulations/ESO.

In a clean conda environment (python 3.9) the following sequence of commands will
install the software and generate the files

```
> git clone git@github.com:AstarVienna/METIS_Simulations.git

> cd METIS_Simulations/ESO
> poetry install
> poetry shell

> ./run_recipes.py
> ./updateHeaders.py
> md5sum -c checksums.dat | grep -v OK
```

The first time you run this, the necessary instrument packages for ScopeSim will be downloaded; comment out the 

```
sim.download_packages(...)
```

lines in simulationDefinitions.py for further work.

run_recipes.py runs ScopeSim using the templates in recipes.yaml, and outputting to the directory output/

updateHeaders.py adds headers not yet included in ScopeSim but needed by the EDPS skeleton. By default, it reads from output/ and *OVERWRITES* the original files. The final step compares the checksums of the files as of release time. 

The files can also be run as

```
> ./run_recipes.py --inputYAML myyaml.yaml --outputDir myOutput
```

which will use a custom input yaml file and output directory and

```
> ./updateHeaders --inDir myDir --outDir myOtherDir
```

will read from a custom directory and output to a custom (and potentially different) directory

```
> ./generateSummary.py
```

will generate a summary tab separated file with the filenames and relevant FITS keywords; this was
used as the base for the spreadsheet linked to above.





